{% extends "base.html" %}

{% block body %}
<main class="container mt-5">
    <h1>Абонементы</h1>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="mt-3">
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">{{ message }}</div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    {% if current_user.membership %}
        <div class="alert alert-info mt-4">
            <strong>Ваш абонемент:</strong> {{ current_user.membership.type }}<br>
            <strong>Дата окончания:</strong> {{ current_user.membership.end_date.strftime('%d.%m.%Y') }}<br>
            <strong>Дни:</strong> {{ current_user.membership.days }}<br>
            <strong>Время:</strong> {{ current_user.membership.time }}<br>
            <form method="post" action="/cancel-membership" class="mt-2">
                <button type="submit" class="btn btn-sm btn-danger">Отменить абонемент</button>
            </form>
        </div>
    {% else %}
        <div class="alert alert-warning mt-4">
            <strong>У вас нет активного абонемента!</strong> Пожалуйста, выберите абонемент и оформите его.
        </div>

        <!-- Выбор абонемента с расписанием -->
        <div class="mt-4">
            <h3>Выберите абонемент</h3>

            <div class="alert alert-secondary">
                <h4>На 8 занятий</h4>
                <button class="btn btn-sm btn-primary" data-toggle="modal" data-target="#scheduleModal" data-membership="8">Оформить абонемент на 8 занятий</button>
            </div>

            <div class="alert alert-secondary">
                <h4>На 12 занятий</h4>
                <button class="btn btn-sm btn-primary" data-toggle="modal" data-target="#scheduleModal" data-membership="12">Оформить абонемент на 12 занятий</button>
            </div>

            <div class="alert alert-secondary">
                <h4>Пробный абонемент</h4>
                <button class="btn btn-sm btn-primary" data-toggle="modal" data-target="#scheduleModal" data-membership="trial">Оформить пробный абонемент</button>
            </div>
        </div>
    {% endif %}
</main>

<!-- Модальное окно для выбора расписания -->
<div class="modal fade" id="scheduleModal" tabindex="-1" role="dialog" aria-labelledby="scheduleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="scheduleModalLabel">Выберите дни и время</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Закрыть">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <form method="post" action="/membership">
                <div class="modal-body">
                    <input type="hidden" name="membership_type" id="membership_type">

                    <div class="form-group">
                        <label for="days">Выберите дни:</label>
                        <select multiple class="form-control" name="days[]" id="days">
                            <option value="Mon">Понедельник</option>
                            <option value="Wed">Среда</option>
                            <option value="Fri">Пятница</option>
                            <option value="Tue">Вторник</option>
                            <option value="Thu">Четверг</option>
                            <option value="Sat">Суббота</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="time">Выберите время:</label>
                        <select class="form-control" name="time" id="time">
                            <option value="9-14">9:00 - 14:00</option>
                            <option value="15-20">15:00 - 20:00</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Закрыть</button>
                    <button type="submit" class="btn btn-primary">Подтвердить выбор</button>
                </div>
            </form>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
    $('#scheduleModal').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget);
        var membershipType = button.data('membership');
        var modal = $(this);
        modal.find('#membership_type').val(membershipType);
    });
</script>
{% endblock %}
